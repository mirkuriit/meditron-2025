# Модуль математического моделирования роста опухоли молочной железы

Этот модуль реализует моделирование динамики опухоли с учётом:

- подтипа опухоли (HR+, HER2+, TNBC),
- пролиферативного индекса Ki-67,
- PK/PD-моделей противоопухолевых препаратов,
- комбинированных схем терапии,
- появления резистентности,
- накопления и клиренса некротических масс,
- автоматической оптимизации дозировок в рамках клинической схемы.

Модель позволяет прогнозировать рост опухоли при различных режимах лечения и автоматически подбирать оптимальные множители доз.

---

## 1. Используемые модели

### 1.1. Модель роста опухоли

Рассматриваются три клеточные популяции:

- **Ns(t)** — чувствительные клетки  
- **Nr(t)** — резистентные клетки  
- **N(t)** — некроз  

Общий объём опухоли:

V(t) = Ns(t) + Nr(t) + N(t)


Уравнения динамики (логистическая модель с терапией и некрозом):

Ns'(t) = r * Ns * (1 - (Ns + Nr + N)/K) - (d_base + D(t)) * Ns - μ * Ns

Nr'(t) = r * Nr * (1 - (Ns + Nr + N)/K) - (d_base + α * D(t)) * Nr + μ * Ns

N'(t) = (d_base + D(t)) * Ns + (d_base + α * D(t)) * Nr - k_clear * N

Где:

- `r` — скорость пролиферации  
- `μ` — скорость перехода `Ns → Nr`  
- `α` — чувствительность резистентных клеток (обычно `α < 1`)  
- `K` — ёмкость среды  
- `k_clear` — скорость клиренса некроза  
- `D(t)` — суммарный лекарственный эффект  

---

### 1.2. Преобразование Ki-67 в скорость роста

r = (ln 2 / T_cycle) * Ki67_fraction


Где:  
`T_cycle` — длительность клеточного цикла подтипа  
`Ki67_fraction` — доля Ki-67 (0–1)  

---

### 1.3. PK-модели препаратов

#### Однокомпартментная модель

A'(t) = - (CL/V1) * A + I(t)
C(t) = A / V1


#### Двухкомпартментная модель

A1'(t) = - (CL/V1) * A1 - (Q/V1) * A1 + (Q/V2) * A2 + I(t)
A2'(t) = (Q/V1) * A1 - (Q/V2) * A2

C(t) = A1 / V1


---

### 1.4. PD-модель (фармакодинамика)

Эффект препарата задаётся Emax-моделью:

E(C) = E_max * C / (C + EC50)


---

### 1.5. Комбинированное воздействие препаратов

Суммарный эффект терапии:

D(t) = Σ_j E_j(t)


---

### 1.6. Оптимизация дозировок

Используются множители доз:

{0.7, 0.85, 1.0, 1.15, 1.3}


Для каждой комбинации проводится моделирование.

Целевая функция:

score = V(t_end)


Минимизируется конечный объём опухоли → выбирается оптимальная комбинация дозировок.

---

## 2. Данные для подтипов опухоли

Для каждого подтипа заданы:

- базовая смертность `d`
- клиренс некроза `k_clear`
- ёмкость среды `K`
- начальная доля некроза `f_N0`
- длительность клеточного цикла `T_cycle`

---

## 3. Схемы терапии

Поддерживаемые форматы:

### `simple`
Один набор препаратов, одинаковый на протяжении всей терапии.

### `phased`
Несколько фаз (например, `AC → T`), каждая со своей длительностью и набором препаратов.

---

## 4. Вход и выход бэкенда

### Вход:

- подтип опухоли (HR+, HER2+, TNBC)
- Ki-67 (в процентах)
- диаметр опухоли (см)
- выбранная схема терапии

### Выход:

Массивы траекторий:

t
V(t)
Ns(t)
Nr(t)
N(t)


А также:

- оптимальные множители доз
- скорректированные дозы препаратов

---

## 5. Краткое объяснение поведения модели

- Чувствительные клетки быстро подавляются терапией.  
- Резистентные клетки продолжают расти при наличии ресурсов.  
- Некроз образуется и медленно выводится, поэтому общий объём может снижаться не сразу.  
- Суммарная динамика опухоли отражает клинически реалистичный ответ.

Модель позволяет исследовать индивидуализированные режимы терапии и улучшать схемы лечения за счёт оптимизации дозировок.
